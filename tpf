#!/bin/sh

FAN_PATH="/proc/acpi/ibm/fan"

show_status() {
    grep -Ev 'commands|watchdog' "$FAN_PATH"
    echo "Settings:       0-7, full, auto, max"
}

set_fan_level() {
    case "$1" in
        max)
            echo "level disengaged" > "$FAN_PATH"
            echo "Fan level set to max (disengaged)"
            ;;
        *)
            echo "level $1" > "$FAN_PATH"
            echo "Fan level set to $1"
            ;;
    esac
}

if [ $# -eq 0 ]; then
    show_status
else
    if [ "$(id -u)" -ne 0 ]; then
        echo "Run as root!"
        exit 1
    fi

    case "$1" in
        auto|full|max|[0-7])
            set_fan_level "$1"
            ;;
        *)
            echo "Invalid level: $1"
            echo "Usage: tpf [0â€“7|full|max|auto]"
            exit 1
            ;;
    esac
fi
